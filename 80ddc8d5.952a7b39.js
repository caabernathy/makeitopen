(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{101:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return h}));var a=n(0),i=n.n(a);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=i.a.createContext({}),p=function(e){var t=i.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},b=function(e){var t=p(e.components);return i.a.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},d=i.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,r=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),b=p(n),d=a,h=b["".concat(r,".").concat(d)]||b[d]||u[d]||o;return n?i.a.createElement(h,s(s({ref:t},l),{},{components:n})):i.a.createElement(h,s({ref:t},l))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,r=new Array(o);r[0]=d;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:a,r[1]=s;for(var l=2;l<o;l++)r[l]=n[l];return i.a.createElement.apply(null,r)}return i.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},114:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/redux_logger-5ffd6b8280964d3f2b292f2b40e3c870.png"},72:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return r})),n.d(t,"metadata",(function(){return s})),n.d(t,"rightToc",(function(){return c})),n.d(t,"default",(function(){return p}));var a=n(2),i=n(6),o=(n(0),n(101)),r={id:"1-4-testing",title:"Testing a React Native App",sidebar_label:"Part 4: Testing a React Native App"},s={unversionedId:"1-4-testing",id:"1-4-testing",isDocsHomePage:!1,title:"Testing a React Native App",description:"This is a series of tutorials designed to introduce React Native and its Open Source ecosystem in plain English, written alongside the building of the F8 2016 app for Android and iOS.",source:"@site/docs/1-4-testing.md",slug:"/1-4-testing",permalink:"/makeitopen/docs/next/1-4-testing",editUrl:"https://github.com/facebook/makeitopen/edit/master/docs/docs/1-4-testing.md",version:"current",lastUpdatedBy:"Christine Abernathy",lastUpdatedAt:1604512976,sidebar_label:"Part 4: Testing a React Native App",sidebar:"docs",previous:{title:"Integrating Data with React Native",permalink:"/makeitopen/docs/next/1-3-data"},next:{title:"Running the App Locally",permalink:"/makeitopen/docs/next/1-A1-local-setup"}},c=[{value:"Flow: Type-checking to Stop Writing Bad Code",id:"flow-type-checking-to-stop-writing-bad-code",children:[]},{value:"Nuclide: A React Native-aware Development Environment",id:"nuclide-a-react-native-aware-development-environment",children:[]},{value:"Jest: Unit Testing for Bug-Free Changes",id:"jest-unit-testing-for-bug-free-changes",children:[]},{value:"Debugging",id:"debugging",children:[]}],l={rightToc:c};function p(e){var t=e.components,r=Object(i.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},l,r,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,Object(o.b)("em",{parentName:"p"},"This is a series of tutorials designed to introduce React Native and its Open Source ecosystem in plain English, written alongside the building of the F8 2016 app for ",Object(o.b)("a",Object(a.a)({parentName:"em"},{href:"https://play.google.com/store/apps/details?id=com.facebook.f8"}),"Android")," and ",Object(o.b)("a",Object(a.a)({parentName:"em"},{href:"https://itunes.apple.com/us/app/f8/id853467066"}),"iOS"),".")),Object(o.b)("p",null,"In classic software development life cycles, the testing phase is always seen as just that - a distinct phase that usually happens near the end of development. This can be even more true when working with freshly minted Open Source frameworks, because their releases tend to not be accompanied by any kind of testing technology."),Object(o.b)("p",null,"Luckily, React Native was built by Facebook from the very beginning with continuous testing techniques in mind. In this part we'll explore how you can use ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"http://nuclide.io"}),"Nuclide"),", ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"http://flowtype.org"}),"Flow"),", and ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"http://facebook.github.io/jest/"}),"Jest")," with React Native to improve the quality of your code as you're writing it."),Object(o.b)("h3",{id:"flow-type-checking-to-stop-writing-bad-code"},"Flow: Type-checking to Stop Writing Bad Code"),Object(o.b)("p",null,Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"http://flowtype.org"}),"Flow")," provides JavaScript with ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"http://flowtype.org/docs/about-flow.html#_"}),"static type checking"),", and works in a gradual way, allowing you to slowly add Flow features to your code. This is really useful because we can introduce type checking in particular parts of the code without having to re-write the entire app to be Flow-compatible."),Object(o.b)("p",null,"In our F8 app, we decided from the start to use React Native with Flow in its most complete form, adding ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"http://flowtype.org/docs/type-annotations.html#_"}),"type annotations")," everywhere necessary, and letting Flow work its magic as we progressed."),Object(o.b)("p",null,"For example, lets look at one of the simple Actions we described in the ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"/makeitopen/docs/next/1-3-data"}),"Data tutorial"),":"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"/* from js/actions/login.js */\n\n/*\n * @flow\n */\n\n...\n\nfunction skipLogin(): Action {\n  return {\n    type: 'SKIPPED_LOGIN',\n  };\n}\n")),Object(o.b)("p",null,"We've added the ",Object(o.b)("inlineCode",{parentName:"p"},"@flow")," flag to the file header (which ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"http://flowtype.org/docs/getting-started.html#_"}),"tells Flow to check the code"),") and then we're using Flow's ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"http://flowtype.org/docs/type-annotations.html#_"}),"type annotations")," to indicate that whatever is returned by ",Object(o.b)("inlineCode",{parentName:"p"},"skipLogin()")," must be of type ",Object(o.b)("inlineCode",{parentName:"p"},"Action"),". But that type isn't built into React Native, or Redux, so we have defined it ourselves:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"/* from js/actions/types.js */\n\nexport type Action =\n    { type: 'LOADED_ABOUT', list: Array<ParseObject> }\n  | { type: 'LOADED_NOTIFICATIONS', list: Array<ParseObject> }\n  | { type: 'LOADED_MAPS', list: Array<ParseObject> }\n  | { type: 'LOADED_FRIENDS_SCHEDULES', list: Array<{ id: string; name: string; schedule: {[key: string]: boolean}; }> }\n  | { type: 'LOADED_CONFIG', config: ParseObject }\n  | { type: 'LOADED_SESSIONS', list: Array<ParseObject> }\n  | { type: 'LOADED_SURVEYS', list: Array<Object> }\n  | { type: 'SUBMITTED_SURVEY_ANSWERS', id: string; }\n  | { type: 'LOGGED_IN', data: { id: string; name: string; sharedSchedule: ?boolean; } }\n  | { type: 'RESTORED_SCHEDULE', list: Array<ParseObject> }\n  | { type: 'SKIPPED_LOGIN' }\n  | { type: 'LOGGED_OUT' }\n  | { type: 'SESSION_ADDED', id: string }\n  | { type: 'SESSION_REMOVED', id: string }\n  | { type: 'SET_SHARING', enabled: boolean }\n  | { type: 'APPLY_TOPICS_FILTER', topics: {[key: string]: boolean} }\n  | { type: 'CLEAR_FILTER' }\n  | { type: 'SWITCH_DAY', day: 1 | 2 }\n  | { type: 'SWITCH_TAB', tab: 'schedule' | 'my-schedule' | 'map' | 'notifications' | 'info' }\n  | { type: 'TURNED_ON_PUSH_NOTIFICATIONS' }\n  | { type: 'REGISTERED_PUSH_NOTIFICATIONS' }\n  | { type: 'SKIPPED_PUSH_NOTIFICATIONS' }\n  | { type: 'RECEIVED_PUSH_NOTIFICATION', notification: Object }\n  | { type: 'SEEN_ALL_NOTIFICATIONS' }\n  | { type: 'RESET_NUXES' }\n  ;\n\n")),Object(o.b)("p",null,"Here we have created a ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"http://flowtype.org/docs/type-aliases.html#_"}),"Flow type alias")," that says that anything of type ",Object(o.b)("inlineCode",{parentName:"p"},"Action")," must be one of a series of different potential object shapes. The ",Object(o.b)("inlineCode",{parentName:"p"},"SKIPPED_LOGIN")," Action must only contain its own type label, whereas for comparison, a ",Object(o.b)("inlineCode",{parentName:"p"},"LOADED_SURVEYS")," Action must return the type label and a list item. We can see that the relevant Action Creator does just that:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"/* from js/actions/surveys.js */\nasync function loadSurveys(): Promise<Action> {\n  const list = await Parse.Cloud.run('surveys');\n  return {\n    type: 'LOADED_SURVEYS',\n    list,\n  };\n}\n")),Object(o.b)("p",null,"Because we are using lots of different Actions in the app, this strong typing check lets us know simple things like having a typo in the type label, or more important things like the data payload being in the wrong format."),Object(o.b)("p",null,"We also then get the same strong typing checks in our Reducers:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"/* from js/reducers/surveys.js */\nfunction surveys(state: State = [], action: Action): State {\n  if (action.type === 'LOADED_SURVEYS') {\n    return action.list;\n  }\n  ...\n  return state;\n}\n")),Object(o.b)("p",null,"Because the ",Object(o.b)("inlineCode",{parentName:"p"},"action")," argument is typed as the same ",Object(o.b)("inlineCode",{parentName:"p"},"Action")," as above, the Reducer function must use an ",Object(o.b)("inlineCode",{parentName:"p"},"action.type")," that is valid. We can also use type aliases to define shapes for the Reducer's ",Object(o.b)("inlineCode",{parentName:"p"},"state")," tree section:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"/* from js/reducers/user.js */\nexport type State = {\n  isLoggedIn: boolean;\n  hasSkippedLogin: boolean;\n  sharedSchedule: ?boolean;\n  id: ?string;\n  name: ?string;\n};\n\nconst initialState = {\n  isLoggedIn: false,\n  hasSkippedLogin: false,\n  sharedSchedule: null,\n  id: null,\n  name: null,\n};\n\nfunction user(state: State = initialState, action: Action): State {\n  ...\n}\n")),Object(o.b)("p",null,"We showed you this ",Object(o.b)("inlineCode",{parentName:"p"},"initialState")," object in the ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"/makeitopen/docs/next/1-3-data"}),"data tutorial"),", but now you can see how we have forced this ",Object(o.b)("inlineCode",{parentName:"p"},"state")," tree section to conform to a defined Flow type. If the Reducer is sent, or tries to return, any ",Object(o.b)("inlineCode",{parentName:"p"},"state")," that doesn't conform to this same shape, we'll see a Flow type checking error."),Object(o.b)("p",null,"Note that Flow checks are run at compile-time only, and the React Native packager ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/facebook/react-native/blob/master/babel-preset/configs/main.js#L32"}),"strips them automatically")," - this means using Flow in your code doesn't have any kind of runtime performance penalty."),Object(o.b)("p",null,"Of course, right now, we still have to manually run the Flow type-checker every time we want to test some code (using the ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"http://flowtype.org/docs/cli.html#_"}),"Flow command line interface"),") but we can also use Nuclide to get this kind of verification ",Object(o.b)("em",{parentName:"p"},"as we write the code"),"."),Object(o.b)("h3",{id:"nuclide-a-react-native-aware-development-environment"},"Nuclide: A React Native-aware Development Environment"),Object(o.b)("p",null,"The ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"http://nuclide.io/docs/platforms/react-native/"}),"Nuclide website")," contains a full rundown of the kind of React Native tailored features it offers, but suffice to say, it's a first-class IDE for React Native, built for the same people at Facebook who created React Native, and who use it to write Facebook apps every day."),Object(o.b)("p",null,"The Flow integration is what we're specifically interested in though. Here we can see a sample of code from the same user Reducer that we showed with the typed ",Object(o.b)("inlineCode",{parentName:"p"},"state")," object above:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"  if (action.type === 'SKIPPED_LOGIN') {\n    return {\n      isLoggedIn: false,\n      hasSkippedLogin: true,\n      sharedSchedule: null,\n      id: null,\n      name: null,\n    };\n  }\n")),Object(o.b)("p",null,"As we said before, we have defined the shape that the Reducer function must return, and with Nuclide, we can see our mistakes happening in real-time:"),Object(o.b)("video",{width:"1174",height:"1002",autoplay:!0,loop:!0},Object(o.b)("source",{src:"/videos/flow.mp4",type:"video/mp4"}),"Your browser does not support the HTML5 video tag."),Object(o.b)("p",null,"If we leave out any part of the State type, something that could happen accidentally but frequently when rapidly building an app, we get instant feedback that we aren't returning the correct type of object."),Object(o.b)("p",null,"Nuclide will do this for all of our relevant Flow type-checking. This means, instead of waiting until the app is nearly completely built, type errors are spotted, and mistakes corrected, as the code is being written."),Object(o.b)("p",null,"It might seem unintuitive, but this actually sped up development - unravelling un-typed code can be really difficult, and doing it all when you've already built your app can be messy."),Object(o.b)("h3",{id:"jest-unit-testing-for-bug-free-changes"},"Jest: Unit Testing for Bug-Free Changes"),Object(o.b)("p",null,Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"http://facebook.github.io/jest/"}),"Jest")," provides a unit test framework for JavaScript, and works well with ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"http://facebook.github.io/react-native/docs/testing.html#content"}),"React Native apps"),"."),Object(o.b)("p",null,"We are using these unit tests to ensure that already built, functional code isn't modified in a way that introduces bugs (also called regression testing)."),Object(o.b)("p",null,"For example, we want to have a Jest test that ensures the Reducer handling maps data continued to work as expected:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"jest.autoMockOff();\n\nconst Parse = require('parse');\nconst maps = require('../maps'); // 1\n\ndescribe('maps reducer', () => {\n\n  it('is empty by default', () => { // 2\n    expect(maps(undefined, {})).toEqual([]);\n  });\n\n  it('populates maps from server', () => { // 3\n    let list = [\n      new Parse.Object({mapTitle: 'Day 1', mapImage: new Parse.File('1.png')}),\n      new Parse.Object({mapTitle: 'Day 2', mapImage: new Parse.File('2.png')}),\n    ];\n\n    expect(\n      maps([], {type: 'LOADED_MAPS', list})\n    ).toEqual([{\n      id: jasmine.any(String),\n      title: 'Day 1',\n      url: '1.png',\n    }, {\n      id: jasmine.any(String),\n      title: 'Day 2',\n      url: '2.png',\n    }]);\n  });\n\n});\n")),Object(o.b)("p",null,"Jest is really easy to read (note that even our Jest tests are Flow typed!), but we'll break it down:"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"We're including the maps Reducer function (",Object(o.b)("inlineCode",{parentName:"p"},"js/reducers/maps.js"),") so that it can be used directly in the unit test (Reducer functions being ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://en.wikipedia.org/wiki/Pure_function"}),"pure functions")," means this is easily done).")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"The first test is ensuring that the Reducer function returns an empty array. If you look at the Reducer code itself in ",Object(o.b)("inlineCode",{parentName:"p"},"js/reducers/maps.js")," you'll see that it doesn't have any initial state, which is why we want an empty array from the unit test.")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"The second test is ensuring that when the map data is retrieved from the Parse API it is correctly transformed by the Reducer function into the correct structure for the ",Object(o.b)("inlineCode",{parentName:"p"},"state")," tree. In this test we are using mock data objects that fully mimic the structure of the actual Parse-stored data - this would avoid any API connection issues causing this test to fail."))),Object(o.b)("p",null,"Now we have to make running the Jest tests part of our development workflow - for example, before every Git commit - and we can be more confident that changes to existing code won't silently break the app."),Object(o.b)("p",null,"The fact that Redux Reducers mutate the ",Object(o.b)("inlineCode",{parentName:"p"},"state")," tree in our app makes it absolutely vital that bugs aren't introduced, especially as bugs with ",Object(o.b)("inlineCode",{parentName:"p"},"state")," mutation could easily be missed as they might not break anything functionally, instead just sending the wrong data to our Parse Server. Their pure function nature also makes them ideal candidates for regression testing because we can more accurately predict how they should perform every time."),Object(o.b)("h3",{id:"debugging"},"Debugging"),Object(o.b)("p",null,"When you're trying to locate a bug, or find a fix for one, it's helpful to have some debugging tools on hand. We've already described ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"/makeitopen/docs/next/1-2-design#the-design-iteration-cycle"}),"how we built a system for debugging our app's visual elements"),", but what about the data?"),Object(o.b)("p",null,"We're using the ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://facebook.github.io/react-native/docs/debugging.html#chrome-developer-tools"}),"Chrome Developer Tools")," through ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"http://nuclide.io/docs/features/debugger/"}),"Nuclide")," along with the ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"http://evgenyrodionov.github.io/redux-logger/"}),"Redux Logger")," middleware, which provides the console with additional Redux context such as Actions or ",Object(o.b)("inlineCode",{parentName:"p"},"state")," changes in Reducers:"),Object(o.b)("p",null,Object(o.b)("img",{alt:"Redux Logger Middleware in action with additional console context",src:n(114).default})),Object(o.b)("p",null,"You can see how we enable this via our ",Object(o.b)("inlineCode",{parentName:"p"},"configureStore")," function:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"/* from js/store/configureStore.js */\nvar createLogger = require('redux-logger');\n...\nvar isDebuggingInChrome = __DEV__ && !!window.navigator.userAgent; // 1\nvar logger = createLogger({ // 2\n  predicate: (getState, action) => isDebuggingInChrome,\n  collapsed: true,\n  duration: true,\n});\n\nvar createF8Store = applyMiddleware(thunk, promise, array, logger)(createStore); // 3\n\nfunction configureStore(onComplete: ?() => void) {\n  const store = autoRehydrate()(createF8Store)(reducers);\n  persistStore(store, {storage: AsyncStorage}, onComplete);\n  if (isDebuggingInChrome) { // 4\n    window.store = store;\n  }\n  return store;\n}\n")),Object(o.b)("p",null,"Here's what's going on:"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"We're triggering extra debugging functionality by using a ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"http://www.w3schools.com/js/js_scope.asp"}),"global variable")," called ",Object(o.b)("inlineCode",{parentName:"p"},"__DEV__")," that'll let us switch into and out of debugging mode with a simple boolean change.")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"We're creating the Logger middleware ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/fcomb/redux-logger#options-1"}),"with some options"),". The debug flag created previously determines whether the created logger middleware actually logs actions (using the ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/fcomb/redux-logger#predicate--getstate-function-action-object--boolean"}),Object(o.b)("inlineCode",{parentName:"a"},"predicate")," option"),").")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"We're applying the middleware using Redux's ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"http://redux.js.org/docs/api/applyMiddleware.html"}),Object(o.b)("inlineCode",{parentName:"a"},"applyMiddleware()")," function"),". This is all we need to do in order to see those logging entries show up in the console.")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"The debug flag adds a copy of the current Store object to the ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"http://www.w3schools.com/jsref/obj_window.asp"}),"Window object"),". This just saves having to add it to the Window everytime, which in turn makes it easier to browse directly via the console."))))}p.isMDXComponent=!0}}]);