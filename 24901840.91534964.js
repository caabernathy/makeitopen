(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{101:function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a.d(t,"b",(function(){return b}));var n=a(0),r=a.n(n);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var d=r.a.createContext({}),p=function(e){var t=r.a.useContext(d),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},c=function(e){var t=p(e.components);return r.a.createElement(d.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},u=r.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,i=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),c=p(a),u=n,b=c["".concat(i,".").concat(u)]||c[u]||h[u]||o;return a?r.a.createElement(b,s(s({ref:t},d),{},{components:a})):r.a.createElement(b,s({ref:t},d))}));function b(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,i=new Array(o);i[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:n,i[1]=s;for(var d=2;d<o;d++)i[d]=a[d];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,a)}u.displayName="MDXCreateElement"},124:function(e,t,a){"use strict";a.r(t),t.default=a.p+"assets/images/demos-view-screenshot-9b3ab4dd3f3893c1c4839f73f2668831.png"},66:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return i})),a.d(t,"metadata",(function(){return s})),a.d(t,"rightToc",(function(){return l})),a.d(t,"default",(function(){return p}));var n=a(2),r=a(6),o=(a(0),a(101)),i={id:"1-A2-relay",title:"Using Relay and GraphQL",sidebar_label:"Appendix II: Using Relay and GraphQL",original_id:"1-A2-relay"},s={unversionedId:"1-A2-relay",id:"version-2017.1.0.0/1-A2-relay",isDocsHomePage:!1,title:"Using Relay and GraphQL",description:"When we originally planned the app we discussed the choice of data layer and compared Redux (which was eventually used) with an alternative Facebook Open Source project called Relay.",source:"@site/versioned_docs/version-2017.1.0.0/1-A2-relay.md",slug:"/1-A2-relay",permalink:"/makeitopen/docs/1-A2-relay",editUrl:"https://github.com/facebook/makeitopen/edit/master/docs/versioned_docs/version-2017.1.0.0/1-A2-relay.md",version:"2017.1.0.0",lastUpdatedBy:"Christine Abernathy",lastUpdatedAt:1604512976,sidebar_label:"Appendix II: Using Relay and GraphQL",sidebar:"version-2017.1.0.0/docs",previous:{title:"Running the App Locally",permalink:"/makeitopen/docs/1-A1-local-setup"},next:{title:"Porting the F8 App To Windows",permalink:"/makeitopen/docs/1-A3-windows"}},l=[{value:"Gradual Evolution",id:"gradual-evolution",children:[]},{value:"Introducing Relay and GraphQL",id:"introducing-relay-and-graphql",children:[]},{value:"An Example from the F8 App",id:"an-example-from-the-f8-app",children:[]}],d={rightToc:l};function p(e){var t=e.components,i=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(n.a)({},d,i,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"When we originally planned the app ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"../2016.1.1.0/1-1-planning.html#data-access-with-react-native"}),"we discussed the choice of data layer")," and compared ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/rackt/redux"}),"Redux")," (which was eventually used) with an alternative Facebook Open Source project called ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://facebook.github.io/relay/"}),"Relay"),"."),Object(o.b)("p",null,"At the time, Redux was chosen because it offered the simpler data implementation of the two, and was quicker and easier to integrate with our Parse data storage."),Object(o.b)("p",null,"Once the app was released to the ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://itunes.apple.com/us/app/f8/id853467066"}),"iOS")," and ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://play.google.com/store/apps/details?id=com.facebook.f8"}),"Android")," app stores, we wanted to revisit that choice, and look at how Relay could work with our app."),Object(o.b)("h3",{id:"gradual-evolution"},"Gradual Evolution"),Object(o.b)("p",null,"With traditional native app development, the choice to switch the data layer would usually lead to a whole-scale rewrite of the entire app, where the existing functionality would be entirely swapped out."),Object(o.b)("p",null,"React Native is very different - we can retain the majority of our existing data setup (Redux, Parse, and the relevant bindings) while also switching to a new data layer for an individual View. Instead of having to rebuild the app from scratch, or do a messy refactor, we can simply adjust one section of the app to use a new data layer and let the rest continue to use the existing layer."),Object(o.b)("p",null,"It is worth stating just how huge a benefit this is to continued development of an app - the ability to progressively enhance an app reduces the overhead for maintenance and updates drastically."),Object(o.b)("p",null,"So how does using Relay and GraphQL compare to the Redux model of thinking about data?"),Object(o.b)("h3",{id:"introducing-relay-and-graphql"},"Introducing Relay and GraphQL"),Object(o.b)("p",null,"Firstly, and in very simple terms, ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://facebook.github.io/relay/"}),"Relay")," is the data framework that lives inside the app, and ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"http://graphql.org/"}),"GraphQL")," is a query language used within Relay to represent the data schema. GraphQL is also run on a server separately from the app to provide a data source for Relay to interact with."),Object(o.b)("p",null,"Relay isn't derived from the Flux architecture and is used only with GraphQL, which immediately means a big difference from the Redux model. The Store/Reducer/Component interaction we covered in the ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"1-3-data.html"}),"data tutorial")," does not really exist with Relay. It takes a different approach, and removes a lot of the building work you normally need to do when integrating data."),Object(o.b)("p",null,"With Relay, each React component specifies exactly what data it depends on, using GraphQL. Relay handles everything about fetching that data, providing the component with updates when the data changes, and caching the data client-side. Anytime the app wants to change the data itself, it creates a ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://facebook.github.io/relay/docs/en/guides-mutations.html"}),"GraphQL Mutation")," instead of an Action as with Redux."),Object(o.b)("h3",{id:"an-example-from-the-f8-app"},"An Example from the F8 App"),Object(o.b)("p",null,"Given the ability to progressively change a small part of a React Native app, we chose, as a kind of proof-of-concept, to swap Redux for Relay in the Demos View of the F8 app:"),Object(o.b)("p",null,Object(o.b)("img",{alt:"Demos view of F8 iOS app",src:a(124).default})),Object(o.b)("p",null,"This part of the app is pretty much entirely separate from the rest, with largely non-interactive content, making it an ideal place to start."),Object(o.b)("p",null,"The view itself contains a simple function ",Object(o.b)("inlineCode",{parentName:"p"},"renderView")," to render the demos list:"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-js"}),'/* from js/tabs/demos/F8DemosView.js */\nclass F8DemosView extends React.Component {\n  ...\n\n  renderView(demos, garages, hasBookables) {\n    const hasBothTables = demos.length && garages.length;\n\n    return (\n      <View style={styles.container}>\n        <View style={styles.header}>\n          <F8BackgroundRepeat\n            width={WINDOW_WIDTH}\n            height={PATTERN_HEIGHT}\n            source={require("../../common/img/pattern-dots.png")}\n            style={styles.headerBackground}\n          />\n          <Image\n            style={styles.headerIllustration}\n            source={require("./img/header.png")}\n          />\n        </View>\n        <View style={styles.contentContainer}>\n          <Heading2 style={styles.mainHeading}>\n            {"Here are the demos\\nyou\u2019ll find at F8."}\n          </Heading2>\n          {this.renderTable(demos, hasBothTables ? "Demos" : undefined)}\n          {this.renderTable(\n            this.props.garages,\n            hasBothTables ? "Developer Garage" : undefined\n          )}\n          {this.renderManageReservationsButton(hasBookables)}\n        </View>\n      </View>\n    );\n  }\n\n  ...\n}\n')),Object(o.b)("p",null,"This is just a basic layout with some other simple info displaying components inside of it, but where are the parameters to the render method coming from? Well, inside the same .js file, we have a ",Object(o.b)("inlineCode",{parentName:"p"},"<QueryRenderer />"),":"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-js"}),'/* from js/tabs/demos/F8DemosView.js */\n<QueryRenderer\n  environment={environment}\n  query={graphql`\n    query F8DemosViewQuery {\n      demos {\n        title\n        description\n        booking\n        location\n        links {\n          title\n          url\n        }\n        logo\n        logoHeight\n        logoWidth\n        devGarage\n      }\n    }\n  `}\n  render={({ error, props }) => {\n    const sortedDemos = sortDemos(idx(props, _ => _.demos));\n    const demos = sortedDemos.filter(d => !d.devGarage);\n    const garages = sortedDemos.filter(d => d.devGarage);\n    const hasBookables = !!sortedDemos.find(d => d.booking);\n    return (\n      <ListContainer\n        headerBackgroundColor={F8Colors.turquoise}\n        headerTitleColor={F8Colors.sapphire}\n        title="Demos"\n        leftItem={{\n          title: "Map",\n          layout: "icon",\n          icon: require("../../common/img/header/map.png"),\n          onPress: _ =>\n            this.props.navigator &&\n            this.props.navigator.push({ maps: true })\n        }}\n      >\n        <PureListView\n          renderRow={_ => {}}\n          renderEmptyList={() =>\n            this.renderView(demos, garages, hasBookables)}\n        />\n      </ListContainer>\n    );\n  }}\n/>\n')),Object(o.b)("p",null,"Here we're defining exactly what data the ",Object(o.b)("inlineCode",{parentName:"p"},"renderView")," method needs to be displayed, as a GraphQL query. This corresponds to the GraphQL object that we are defining on our GraphQL server:"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-js"}),'/* from server/graphql/src/schema/demo.js */\nconst demoType = new GraphQLObjectType({\n  name: "Demo",\n  fields: () => ({\n    id: globalIdField(),\n    title: {\n      type: GraphQLString,\n      resolve: demo => demo.get("title")\n    },\n    ...\n    devGarage: {\n      type: GraphQLBoolean,\n      resolve: demo => demo.get("devGarage")\n    }\n  }),\n  interfaces: () => [require("./node").nodeInterface]\n});\n')),Object(o.b)("p",null,"You can see how the data is fetched by the GraphQL server, then Relay takes care of grabbing all the required data specified in the fragment. This data becomes available as the ",Object(o.b)("inlineCode",{parentName:"p"},"props")," parameters in the function passed to the ",Object(o.b)("inlineCode",{parentName:"p"},"<QueryRender />"),"'s' render prop."),Object(o.b)("p",null,"Thanks to Relay's built-in logic, we don't need to worry about subscribing to data changes, or caching data in a Store, or anything else - we just tell Relay what data our component should have, and we design our component in the standard React way. With our GraphQL server already set up, that's all we need to do."),Object(o.b)("p",null,"We have no data changes in this view, however if you want to learn more about how they work, please ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://facebook.github.io/relay/docs/guides-mutations.html"}),"read the Relay docs on mutations"),"."))}p.isMDXComponent=!0}}]);